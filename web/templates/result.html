{% extends 'base.html' %}

{% block head %}
<style>
    #map {
        height: 400px;
        width: 100%;
    }
</style>
{% endblock %}
{% block body %}
<h2>Hasil pencarian Rute</h2>
<br>
<div id="map"></div>
<!-- <input onclick="deleteMarkers()" type="button" value="Clear" /> -->

<form action="{{ url_for('index') }}" method="get"> 
    <button>Kembali</button>
</form>
<script>
    let map

    var json = "{{ res }}"
    var listCoor = JSON.parse(json.replace(/&#34;/g,'"'))

    var node = "{{ node }}"
    var listNode = JSON.parse(node.replace(/&#34;/g,'"'))

    var name = "{{ nodeNames }}"
    var nodeNames = JSON.parse(name.replace(/&#34;/g,'"'))

    console.log(nodeNames)

    
    
    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 15,
            center: listCoor[0],
            mapTypeId: "terrain",
        });

        function addMarker(props) {
            var marker = new google.maps.Marker({
                position: props.coor,
                map: map
            })

            var infoWindow = new google.maps.InfoWindow({
                content: props.content
            })

            marker.addListener('click', function() {
                infoWindow.open(map, marker)
            })
        }
        
        const route = new google.maps.Polyline({
            path: listCoor,
            geodesic: true,
            strokeColor: "#FF0000",
            strokeOpacity: 1.0,
            strokeWeight: 2,
        });
        route.setMap(map);

        for (var i = 0; i < listNode.length; i++) {
            var label = "<h3>" + nodeNames[i] + "</h3>"
            addMarker({coor:listNode[i], content:label})
        }

    } 


    
</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbFefdoheWQ7qwuk3nGF882AgcwoErzl8&callback=initMap">
</script>
<!-- <script type = "text/javascript" src="{{ url_for('static', filename='map.js') }}"></script> -->
{% endblock %}